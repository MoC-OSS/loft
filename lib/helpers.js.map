{"version":3,"file":"helpers.js","names":["DateTime","redisKeyRegex","getTimestamp","local","toUTC","toSeconds","sanitizeAndValidateRedisKey","key","sanitizedKey","replace","test","Error","deepEqual","obj1","obj2","keys1","Object","keys","keys2","length","includes","sleep","ms","Promise","resolve","setTimeout","isNotUndefined","value","undefined","getContentOfChoiceByIndex","ctx","index","llmResponse","candidates","content","modifyContentOfChoiceByIndex","newContent","choiceMessage"],"sources":["../src/helpers.ts"],"sourcesContent":["import { DateTime } from 'luxon';\nimport { OutputContext } from './@types';\nexport const redisKeyRegex = /^[a-zA-Z0-9:_\\.-]*$/;\n\nexport function getTimestamp() {\n  return DateTime.local().toUTC().toSeconds();\n}\n\ntype SanitizeRedisKey = string;\nexport function sanitizeAndValidateRedisKey(key: string): SanitizeRedisKey {\n  // Regular expression to test key\n  // This expression will allow alphanumeric characters (a-z, A-Z, 0-9) and the specified symbols (: . - _)\n  const sanitizedKey = key.replace(/[\\n\\r\\t\\b]/g, '');\n\n  if (redisKeyRegex.test(key)) {\n    return sanitizedKey;\n  } else {\n    throw new Error(\n      'Invalid Redis key. Allowed only alphanumeric characters (a-z, A-Z, 0-9) and the specified symbols (: . - _)`',\n    );\n  }\n}\n\nexport function deepEqual(\n  obj1: Record<string, any>,\n  obj2: Record<string, any>,\n) {\n  if (obj1 === obj2) {\n    return true;\n  }\n\n  if (\n    typeof obj1 !== 'object' ||\n    obj1 === null ||\n    typeof obj2 !== 'object' ||\n    obj2 === null\n  ) {\n    return false;\n  }\n\n  let keys1 = Object.keys(obj1);\n  let keys2 = Object.keys(obj2);\n\n  if (keys1.length !== keys2.length) {\n    return false;\n  }\n\n  for (let key of keys1) {\n    if (!keys2.includes(key) || !deepEqual(obj1[key], obj2[key])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport async function sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nexport function isNotUndefined<T>(value: T | undefined): value is T {\n  return value !== undefined;\n}\n\n// A function to get the content of a choice by index\nexport function getContentOfChoiceByIndex(\n  ctx: OutputContext,\n  index: number = 0,\n): string | undefined {\n  return ctx.llmResponse?.candidates[index].content;\n}\n\n// A function to modify the content of a choice by index\nexport function modifyContentOfChoiceByIndex(\n  ctx: OutputContext,\n  index: number,\n  newContent: string,\n): void {\n  const choiceMessage = ctx.llmResponse?.candidates[index];\n  if (choiceMessage) {\n    choiceMessage.content = newContent;\n  }\n}\n"],"mappings":"AAAA,OAASA,QAAQ,KAAQ,OAAO,CAEhC,MAAO,MAAM,CAAAC,aAAa,CAAG,qBAAqB,CAElD,MAAO,SAAS,CAAAC,YAAYA,CAAA,CAAG,CAC7B,MAAO,CAAAF,QAAQ,CAACG,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,CAAC,CAACC,SAAS,CAAC,CAC5C,CAGA,MAAO,SAAS,CAAAC,2BAA2BA,CAACC,GAAW,CAAoB,CAGzE,KAAM,CAAAC,YAAY,CAAGD,GAAG,CAACE,OAAO,CAAC,aAAa,CAAE,EAAE,CAAC,CAEnD,GAAIR,aAAa,CAACS,IAAI,CAACH,GAAG,CAAC,CAAE,CAC3B,MAAO,CAAAC,YACT,CAAC,IAAM,CACL,KAAM,IAAI,CAAAG,KAAK,CACb,8GACF,CACF,CACF,CAEA,MAAO,SAAS,CAAAC,SAASA,CACvBC,IAAyB,CACzBC,IAAyB,CACzB,CACA,GAAID,IAAI,GAAKC,IAAI,CAAE,CACjB,MAAO,KACT,CAEA,GACE,MAAO,CAAAD,IAAI,GAAK,QAAQ,EACxBA,IAAI,GAAK,IAAI,EACb,MAAO,CAAAC,IAAI,GAAK,QAAQ,EACxBA,IAAI,GAAK,IAAI,CACb,CACA,MAAO,MACT,CAEA,GAAI,CAAAC,KAAK,CAAGC,MAAM,CAACC,IAAI,CAACJ,IAAI,CAAC,CAC7B,GAAI,CAAAK,KAAK,CAAGF,MAAM,CAACC,IAAI,CAACH,IAAI,CAAC,CAE7B,GAAIC,KAAK,CAACI,MAAM,GAAKD,KAAK,CAACC,MAAM,CAAE,CACjC,MAAO,MACT,CAEA,IAAK,GAAI,CAAAZ,GAAG,GAAI,CAAAQ,KAAK,CAAE,CACrB,GAAI,CAACG,KAAK,CAACE,QAAQ,CAACb,GAAG,CAAC,EAAI,CAACK,SAAS,CAACC,IAAI,CAACN,GAAG,CAAC,CAAEO,IAAI,CAACP,GAAG,CAAC,CAAC,CAAE,CAC5D,MAAO,MACT,CACF,CAEA,MAAO,KACT,CAEA,MAAO,eAAe,CAAAc,KAAKA,CAACC,EAAU,CAAiB,CACrD,MAAO,IAAI,CAAAC,OAAO,CAAEC,OAAO,EAAKC,UAAU,CAACD,OAAO,CAAEF,EAAE,CAAC,CACzD,CAEA,MAAO,SAAS,CAAAI,cAAcA,CAAIC,KAAoB,CAAc,CAClE,MAAO,CAAAA,KAAK,GAAKC,SACnB,CAGA,MAAO,SAAS,CAAAC,yBAAyBA,CACvCC,GAAkB,CAClBC,KAAa,CAAG,CAAC,CACG,CACpB,MAAO,CAAAD,GAAG,CAACE,WAAW,EAAEC,UAAU,CAACF,KAAK,CAAC,CAACG,OAC5C,CAGA,MAAO,SAAS,CAAAC,4BAA4BA,CAC1CL,GAAkB,CAClBC,KAAa,CACbK,UAAkB,CACZ,CACN,KAAM,CAAAC,aAAa,CAAGP,GAAG,CAACE,WAAW,EAAEC,UAAU,CAACF,KAAK,CAAC,CACxD,GAAIM,aAAa,CAAE,CACjBA,aAAa,CAACH,OAAO,CAAGE,UAC1B,CACF"}